if (-not (([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator))) { Add-Type -AssemblyName System.Windows.Forms; [System.Windows.Forms.MessageBox]::Show('This script requires you to run powershell as admin.', 'Insufficient Permissions', [System.Windows.Forms.MessageBoxButtons]::OK, [System.Windows.Forms.MessageBoxIcon]::Warning); exit 1 }; Add-Type -AssemblyName System.Windows.Forms; $cv = $null; try { $cv = Get-ItemProperty 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion' -ErrorAction Stop } catch {}; $product = $cv.ProductName; $build = 0; if ($cv -and $cv.PSObject.Properties.Name -contains 'CurrentBuildNumber') { $build = [int]$cv.CurrentBuildNumber } elseif ($cv -and $cv.PSObject.Properties.Name -contains 'CurrentBuild') { $build = [int]$cv.CurrentBuild }; if (-not $product) { try { $wmi = Get-CimInstance Win32_OperatingSystem -ErrorAction Stop; $wmiVer = $wmi.Version } catch {} }; $isWin11 = $false; if ($product -and $product -match 'Windows 11') { $isWin11 = $true } elseif ($build -ge 22000) { $isWin11 = $true } elseif ($wmiVer) { try { $v = [version]$wmiVer; if ($build -ge 22000) { $isWin11 = $true } } catch {} }; if (-not $isWin11) { [System.Windows.Forms.MessageBox]::Show("This script is intended for Windows 11. Please refer to the Google for instructions on disabling virtualization in your BIOS.`nMotherboard + Disable Virtualization", 'Unsupported Version', [System.Windows.Forms.MessageBoxButtons]::OK, [System.Windows.Forms.MessageBoxIcon]::Warning); exit 1 }; try { $lm = [Microsoft.Win32.Registry]::LocalMachine; $reg = 'SYSTEM\CurrentControlSet\Control\DeviceGuard\Scenarios\WindowsHello'; $key = $lm.CreateSubKey($reg); $key.SetValue('', 0, [Microsoft.Win32.RegistryValueKind]::DWord); [System.Windows.Forms.MessageBox]::Show("Successfully set default value to 0. Please restart your computer. If it still fails to load, please disable virtualization in your BIOS.`nS/o to stormpike B-)", 'Success', [System.Windows.Forms.MessageBoxButtons]::OK, [System.Windows.Forms.MessageBoxIcon]::Information); exit 0 } catch { [System.Windows.Forms.MessageBox]::Show("Error: $($_.Exception.Message)", 'Error', [System.Windows.Forms.MessageBoxButtons]::OK, [System.Windows.Forms.MessageBoxIcon]::Error); exit 2 }
